<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</title>
  <link rel="stylesheet" href="static/styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="container">
    <h1 data-i18n="title">üìù –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</h1>
    <form id="profileForm">
      <input type="text" name="name" data-ph="name" placeholder="–ò–º—è" required />
      <input type="number" name="age" data-ph="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" required min="18" />

      <select name="gender" required>
        <option data-i18n="gender" value="">–ü–æ–ª</option>
        <option data-i18n="male" value="male">–ú—É–∂—á–∏–Ω–∞</option>
        <option data-i18n="female" value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
      </select>

      <select name="city" id="cityInput" required>
        <option data-i18n="city" value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
      </select>

      <input type="number" name="height" data-ph="height" placeholder="–†–æ—Å—Ç (—Å–º)" required min="120" max="230" />
      <input type="number" name="weight" data-ph="weight" placeholder="–í–µ—Å (–∫–≥)" required min="30" max="250" />

      <select name="marital_status" id="maritalStatusInput" required>
        <option data-i18n="marital_status" value="">–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ</option>
      </select>

      <select name="has_children" required>
        <option data-i18n="has_children" value="">–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏?</option>
        <option data-i18n="yes" value="true">–î–∞</option>
        <option data-i18n="no" value="false">–ù–µ—Ç</option>
      </select>

      <select name="education" required>
        <option data-i18n="education" value="">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
        <option data-i18n="primary" value="primary">–ù–∞—á–∞–ª—å–Ω–æ–µ</option>
        <option data-i18n="secondary" value="secondary">–°—Ä–µ–¥–Ω–µ–µ</option>
        <option data-i18n="incomplete_higher" value="incomplete_higher">–ù–µ–æ–∫–æ–Ω—á–µ–Ω–Ω–æ–µ –≤—ã—Å—à–µ–µ</option>
        <option data-i18n="higher" value="higher">–í—ã—Å—à–µ–µ</option>
      </select>

      <select name="goal" required>
        <option data-i18n="goal" value="">–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞</option>
        <option data-i18n="friendship" value="friendship">–î—Ä—É–∂–±–∞</option>
        <option data-i18n="communication" value="communication">–û–±—â–µ–Ω–∏–µ</option>
        <option data-i18n="serious_relationship" value="serious_relationship">–°–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è</option>
        <option data-i18n="marriage" value="marriage">–ë—Ä–∞–∫</option>
      </select>

      <select name="religion" id="religionInput" required>
        <option data-i18n="religion" value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ª–∏–≥–∏—é</option>
      </select>

      <select name="religious_level">
        <option data-i18n="religious_level" value="">–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã?</option>
        <option data-i18n="none" value="none">–ù–µ —Ä–µ–ª–∏–≥–∏–æ–∑–µ–Ω(–∞)</option>
        <option data-i18n="low" value="low">–ù–µ–º–Ω–æ–≥–æ</option>
        <option data-i18n="medium" value="medium">–°—Ä–µ–¥–Ω–µ</option>
        <option data-i18n="high" value="high">–û—á–µ–Ω—å</option>
        <option data-i18n="strict" value="strict">–°–ª–µ–¥—É—é –≤—Å–µ–º –Ω–æ—Ä–º–∞–º</option>
      </select>

      <select name="ethnicity" id="ethnicityInput" required>
        <option data-i18n="ethnicity" value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</option>
      </select>

      <input type="text" name="job" data-ph="job" placeholder="–ü—Ä–æ—Ñ–µ—Å—Å–∏—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" />
      <textarea name="about" data-ph="about" placeholder="–û —Å–µ–±–µ (–ø—Ä–æ—Å–∏–º –≤–∞—Å –∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ —á—Ç–æ –±—ã –º—ã –º–æ–≥–ª–∏ –≤–∞–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å—á–∞—Å—Ç—å–µ ü´†)" maxlength="300"></textarea>
      <textarea name="looking_for" data-ph="looking_for" placeholder="–ö–æ–≥–æ –∏—â–∏—Ç–µ? (–ø—Ä–æ—Å–∏–º –æ–ø–∏—Å–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ —á—Ç–æ –±—ã –≤–∞—à–µ —Å—á–∞—Å—Ç—å–µ –º–æ–≥–ª–æ –≤–∞—Å –Ω–∞–π—Ç–∏)" maxlength="300"></textarea>

      <button type="submit" data-i18n="submit">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  </div>

  <!-- –°–ö–†–ò–ü–¢ -->
  <script>
    // Telegram WebApp
    const tg = window.Telegram?.WebApp;
    tg?.expand();

    // –Ø–∑—ã–∫ –∏–∑ query (?language=ru|uz|en)
    const urlParams = new URLSearchParams(window.location.search);
    const language = (urlParams.get("language") || "ru").toLowerCase();

    // –°–ø–∏—Å–∫–∏ –∏–∑ –±—ç–∫–∞
    const cityInput = document.getElementById("cityInput");
    const ethnicityInput = document.getElementById("ethnicityInput");
    const religionInput = document.getElementById("religionInput");
    const maritalStatusInput = document.getElementById("maritalStatusInput");

    let citiesList = [];
    let ethnicitiesList = [];
    let religionsList = [];
    let maritalStatusesList = [];

    // ===== i18n —Å–ª–æ–≤–∞—Ä—å =====
    const i18n = {
      ru: {
        title: "üìù –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å",
        name: "–ò–º—è",
        age: "–í–æ–∑—Ä–∞—Å—Ç",
        gender: "–ü–æ–ª",
        male: "–ú—É–∂—á–∏–Ω–∞",
        female: "–ñ–µ–Ω—â–∏–Ω–∞",
        city: "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥",
        height: "–†–æ—Å—Ç (—Å–º)",
        weight: "–í–µ—Å (–∫–≥)",
        marital_status: "–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ",
        has_children: "–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏?",
        yes: "–î–∞",
        no: "–ù–µ—Ç",
        education: "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
        primary: "–ù–∞—á–∞–ª—å–Ω–æ–µ",
        secondary: "–°—Ä–µ–¥–Ω–µ–µ",
        incomplete_higher: "–ù–µ–æ–∫–æ–Ω—á–µ–Ω–Ω–æ–µ –≤—ã—Å—à–µ–µ",
        higher: "–í—ã—Å—à–µ–µ",
        goal: "–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞",
        friendship: "–î—Ä—É–∂–±–∞",
        communication: "–û–±—â–µ–Ω–∏–µ",
        serious_relationship: "–°–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
        marriage: "–ë—Ä–∞–∫",
        religion: "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ª–∏–≥–∏—é",
        religious_level: "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã?",
        none: "–ù–µ —Ä–µ–ª–∏–≥–∏–æ–∑–µ–Ω(–∞)",
        low: "–ù–µ–º–Ω–æ–≥–æ",
        medium: "–°—Ä–µ–¥–Ω–µ",
        high: "–û—á–µ–Ω—å",
        strict: "–°–ª–µ–¥—É—é –≤—Å–µ–º –Ω–æ—Ä–º–∞–º",
        ethnicity: "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å",
        job: "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é)",
        about: "–û —Å–µ–±–µ (–ø—Ä–æ—Å–∏–º –≤–∞—Å –∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –≤–∞–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å—á–∞—Å—Ç—å–µ ü´†)",
        looking_for: "–ö–æ–≥–æ –∏—â–∏—Ç–µ? (–æ–ø–∏—à–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ)",
        submit: "‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        msg_sent: "–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!",
        msg_error: "–û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ."
      },
      uz: {
        title: "üìù –ü—Ä–æ—Ñ–∏–ª–Ω–∏ —Ç—û–ª–¥–∏—Ä–∏–Ω–≥",
        name: "–ò—Å–º",
        age: "–Å—à",
        gender: "–ñ–∏–Ω—Å",
        male: "–≠—Ä–∫–∞–∫",
        female: "–ê–π–æ–ª",
        city: "–®–∞“≥–∞—Ä–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥",
        height: "–ë—û–π–∏ (—Å–º)",
        weight: "–í–∞–∑–Ω–∏ (–∫–≥)",
        marital_status: "–û–∏–ª–∞–≤–∏–π “≥–æ–ª–∞—Ç–∏",
        has_children: "–§–∞—Ä–∑–∞–Ω–¥–∏–Ω–≥–∏–∑ –±–æ—Ä–º–∏?",
        yes: "“≤–∞",
        no: "–ô—û“õ",
        education: "–ú–∞—ä–ª—É–º–æ—Ç–∏",
        primary: "–ë–æ—à–ª–∞–Ω“ì–∏—á",
        secondary: "–é—Ä—Ç–∞",
        incomplete_higher: "–¢—É–≥–∞–ª–ª–∞–Ω–º–∞–≥–∞–Ω –æ–ª–∏–π",
        higher: "–û–ª–∏–π",
        goal: "–¢–∞–Ω–∏—à—É–≤ –º–∞“õ—Å–∞–¥–∏",
        friendship: "–î—û—Å—Ç–ª–∏–∫",
        communication: "–ú—É–ª–æ“õ–æ—Ç",
        serious_relationship: "–ñ–∏–¥–¥–∏–π –º—É–Ω–æ—Å–∞–±–∞—Ç",
        marriage: "–ù–∏–∫–æ“≥",
        religion: "–î–∏–Ω–∏–Ω–≥–∏–∑–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥",
        religious_level: "“ö–∞–Ω—á–∞ –¥–∏–Ω–¥—É—Ä—Å–∏–∑?",
        none: "–î–∏–Ω–¥–æ—Ä —ç–º–∞—Å–º–∞–Ω",
        low: "–ë–∏—Ä–æ–∑",
        medium: "–é—Ä—Ç–∞—á–∞",
        high: "–ñ—É–¥–∞",
        strict: "–ë–∞—Ä—á–∞ “õ–æ–∏–¥–∞–ª–∞—Ä–≥–∞ –∞–º–∞–ª “õ–∏–ª–∞–º–∞–Ω",
        ethnicity: "–ú–∏–ª–ª–∞—Ç–∏–Ω–≥–∏–∑–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥",
        job: "–ö–∞—Å–± (–∏—Ö—Ç–∏—ë—Ä–∏–π)",
        about: "–é–∑–∏–Ω–≥–∏–∑ “≥–∞“õ–∏–Ω–≥–∏–∑–¥–∞ –±–∞—Ç–∞—Ñ—Å–∏–ª —ë–∑–∏–Ω–≥ (—Å–∏—Ñ–∞—Ç–ª–∏ –º–æ—Å–ª–∏–∫ —É—á—É–Ω) ü´†",
        looking_for: "–ö–∏–º–Ω–∏ “õ–∏–¥–∏—Ä–º–æ“õ–¥–∞—Å–∏–∑? (–±–∞—Ç–∞—Ñ—Å–∏–ª —ë–∑–∏–Ω–≥)",
        submit: "‚úÖ –Æ–±–æ—Ä–∏—à",
        msg_sent: "–ú–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä —é–±–æ—Ä–∏–ª–¥–∏!",
        msg_error: "–•–∞—Ç–æ. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–Ω–∏ —Ç–µ–∫—à–∏—Ä–∏–Ω–≥."
      },
      en: {
        title: "üìù Complete your profile",
        name: "Name",
        age: "Age",
        gender: "Gender",
        male: "Male",
        female: "Female",
        city: "Select a city",
        height: "Height (cm)",
        weight: "Weight (kg)",
        marital_status: "Marital status",
        has_children: "Do you have children?",
        yes: "Yes",
        no: "No",
        education: "Education",
        primary: "Primary",
        secondary: "Secondary",
        incomplete_higher: "Incomplete higher",
        higher: "Higher",
        goal: "Dating goal",
        friendship: "Friendship",
        communication: "Communication",
        serious_relationship: "Serious relationship",
        marriage: "Marriage",
        religion: "Choose a religion",
        religious_level: "How religious are you?",
        none: "Not religious",
        low: "A little",
        medium: "Moderate",
        high: "Very",
        strict: "Follow all norms",
        ethnicity: "Select nationality",
        job: "Job (optional)",
        about: "About me (please be as detailed as possible so we can match you well) ü´†",
        looking_for: "Who are you looking for? (be detailed)",
        submit: "‚úÖ Submit",
        msg_sent: "Data sent!",
        msg_error: "Error. Check your connection."
      }
    };

    const T = (key) => (i18n[language] && i18n[language][key]) || i18n.ru[key] || key;

    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–∞–º –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º
    function applyTranslationsStatic() {
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n
      document.querySelectorAll("[data-i18n]").forEach(el => {
        el.textContent = T(el.getAttribute("data-i18n"));
      });
      // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
      document.querySelectorAll("[data-ph]").forEach(el => {
        el.placeholder = T(el.getAttribute("data-ph"));
      });
      // –ê—Ç—Ä–∏–±—É—Ç lang –Ω–∞ html
      document.documentElement.setAttribute("lang", language);
      // Title
      document.title = T("title");
    }

    // –ß—Ç–µ–Ω–∏–µ –ø–æ–ª–∞ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ø–∏—Å–∫–æ–≤
    const getGender = () => document.querySelector("select[name='gender']").value || "male";

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏–∑ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)
    function fillFormFromQuery() {
      const map = {
        name: "input[name='name']",
        age: "input[name='age']",
        gender: "select[name='gender']",
        city_id: "#cityInput",
        height: "input[name='height']",
        weight: "input[name='weight']",
        marital_status_id: "#maritalStatusInput",
        has_children: "select[name='has_children']",
        education: "select[name='education']",
        goal: "select[name='goal']",
        religion_id: "#religionInput",
        religious_level: "select[name='religious_level']",
        ethnicity_id: "#ethnicityInput",
        job: "input[name='job']",
        about: "textarea[name='about']",
        looking_for: "textarea[name='looking_for']"
      };
      for (const [param, selector] of Object.entries(map)) {
        const val = urlParams.get(param);
        if (val !== null) {
          const el = document.querySelector(selector);
          if (el) el.value = val;
        }
      }
    }

    // ===== –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–ø—Ü–∏–π —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞/–ø–æ–ª–∞ =====
    async function loadCities() {
      try {
        const response = await fetch('/cities');
        const cities = await response.json();
        citiesList = cities;

        cityInput.innerHTML = `<option value="">${T("city")}</option>`;
        cities.forEach(city => {
          const option = document.createElement('option');
          option.value = city.id;
          option.textContent = city[language] || city.ru || city.en || city.uz || String(city.id);
          cityInput.appendChild(option);
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤:", e);
      }
    }

    async function loadReligions() {
      try {
        const response = await fetch('/religions');
        const religions = await response.json();
        religionsList = religions;

        religionInput.innerHTML = `<option value="">${T("religion")}</option>`;
        religions.forEach(r => {
          const option = document.createElement('option');
          option.value = r.id;
          option.textContent = r[language] || r.ru || r.en || r.uz || String(r.id);
          religionInput.appendChild(option);
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–ª–∏–≥–∏–π:", e);
      }
    }

    function keyByLangGender(base) {
      // base: –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ *_male / *_female
      const g = getGender(); // male|female
      const key = `${language}_${g}`;
      return base[key] || base[`ru_${g}`] || base[`en_${g}`] || base[`uz_${g}`];
    }

    async function loadEthnicities() {
      try {
        const response = await fetch('/ethnicities');
        const ethnicities = await response.json();
        ethnicitiesList = ethnicities;

        ethnicityInput.innerHTML = `<option value="">${T("ethnicity")}</option>`;
        ethnicities.forEach(e => {
          const option = document.createElement('option');
          option.value = e.id;
          option.textContent = keyByLangGender(e) || String(e.id);
          ethnicityInput.appendChild(option);
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π:", e);
      }
    }

    async function loadMaritalStatuses() {
      try {
        const response = await fetch('/marital_statuses');
        const statuses = await response.json();
        maritalStatusesList = statuses;

        maritalStatusInput.innerHTML = `<option value="">${T("marital_status")}</option>`;
        statuses.forEach(s => {
          const option = document.createElement('option');
          option.value = s.id;
          option.textContent = keyByLangGender(s) || String(s.id);
          maritalStatusInput.appendChild(option);
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–º–µ–π–Ω–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è:", e);
      }
    }

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º—ã–µ —Å–ø–∏—Å–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª–∞
    document.querySelector("select[name='gender']").addEventListener("change", () => {
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ (–ø–æ–¥–ø–∏—Å–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–æ–ª–∞)
      loadEthnicities();
      loadMaritalStatuses();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (async function init() {
      applyTranslationsStatic();
      await Promise.all([loadCities(), loadReligions(), loadEthnicities(), loadMaritalStatuses()]);
      fillFormFromQuery();
      // –ü–æ—Å–ª–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–æ–∏—Ç —Å–Ω–æ–≤–∞ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ–ø—Ü–∏–π (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–¥–º–µ–Ω–∏–ª option[0])
      applyTranslationsStatic();
    })();

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById("profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target).entries());

      // –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
      formData.has_children = formData.has_children === "true";

      // –ü–æ–¥–ø–∏—Å–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –±–æ—Ç
      const selectedCity = citiesList.find(c => String(c.id) === String(formData.city));
      const selectedRel = religionsList.find(r => String(r.id) === String(formData.religion));
      const selectedEth = ethnicitiesList.find(x => String(x.id) === String(formData.ethnicity));
      const selectedMs = maritalStatusesList.find(x => String(x.id) === String(formData.marital_status));
      const g = getGender();
      const langGenderKey = `${language}_${g}`;

      const payload = {
        action: 'profile_submit',
        ...formData,
        city_name: selectedCity ? (selectedCity[language] || selectedCity.ru || selectedCity.en || selectedCity.uz) : formData.city,
        religion_name: selectedRel ? (selectedRel[language] || selectedRel.ru || selectedRel.en || selectedRel.uz) : formData.religion,
        ethnicity_name: selectedEth ? (selectedEth[langGenderKey] || selectedEth[`ru_${g}`] || selectedEth[`en_${g}`] || selectedEth[`uz_${g}`]) : formData.ethnicity,
        marital_status_name: selectedMs ? (selectedMs[langGenderKey] || selectedMs[`ru_${g}`] || selectedMs[`en_${g}`] || selectedMs[`uz_${g}`]) : formData.marital_status,
        ui_language: language,
        user_id: tg?.initDataUnsafe?.user?.id
      };

      try {
        console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞:", payload);
        tg?.sendData(JSON.stringify(payload));
        alert(T("msg_sent"));
      } catch (err) {
        console.error(err);
        alert(T("msg_error"));
      }
    });
  </script>
</body>
</html>
